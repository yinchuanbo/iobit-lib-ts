"use strict";function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach((function(e){_defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Language=function(t){return t.en="en",t.ar="ar",t.tw="tw",t.kr="kr",t.jp="jp",t.it="it",t.fr="fr",t.de="de",t.pt="pt",t.es="es",t}(Language||{}),Env=function(t){return t.Production="production",t.Test="test",t}(Env||{});const httpsTempLib=function(t){return`https://${t}/`},hostLib=location.host;let langLib,domainPrefix,curDomain,environment,baseApiLib,baseApiOldLib,siteName="vidnoz";const setEnvByWebite=function(t=""){curDomain=`${domainPrefix}.${t}.com`,environment=hostLib.includes(curDomain)?Env.Production:Env.Test,baseApiLib=httpsTempLib(environment===Env.Production?`tool-api.${t}.com`:`tool-api-test.${t}.com`),"vidnoz"===t&&(baseApiOldLib=httpsTempLib(environment===Env.Production?`api.${t}.com`:`api-test.${t}.com`))},errorTips=function(t=""){throw new Error(`${t}`)},setGloalData=function(t){t in Language?(langLib=t,domainPrefix=langLib===Language.en?"www":langLib):errorTips("Language not supported")},setVars=function(t,e){switch(setGloalData(t),siteName=e,e){case"vidnoz":case"miocreate":setEnvByWebite(e);break;default:errorTips("Website name not supported")}};class Memory{setItem(t,e){t&&(t=t.toString(),e="string"==typeof e?e:JSON.stringify(e),window.localStorage.setItem(t,e))}getItem(t){try{const e=localStorage.getItem(t);return null===e?null:JSON.parse(e)}catch(t){return null}}removeItem(t){t?"string"==typeof t?window.localStorage.removeItem(t):Array.isArray(t)&&t.forEach((function(t){return window.localStorage.removeItem(t)})):window.localStorage.clear()}getCookie(t){const e=document.cookie.split(";");for(const n of e){const[e,o]=n.trim().split("=");if(e===t)return decodeURIComponent(o)}return null}}class Methods{isMobile(){const t=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}isIosOrAndroid(){const t=navigator.userAgent.toLowerCase().indexOf("android")>-1,e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return t?"android":e?"ios":void 0}async copyText(t){function e(t){const e=document.createElement("textarea");e.value=t,e.style.width="100px",e.style.position="fixed",e.style.left="-999px",e.style.top="10px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}if(navigator.clipboard&&navigator.permissions)try{await navigator.clipboard.writeText(t)}catch(n){console.error("Failed to copy text using Clipboard API:",n),e(t)}else e(t)}watchFileUpload(t,e){t.addEventListener("change",(function(t){var n;const o=null===(n=t.target.files)||void 0===n?void 0:n[0];o&&e(o)}))}getType(t){const e=Object.prototype.toString,n={undefined:"undefined",number:"number",boolean:"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"};return n[typeof t]||n[e.call(t)]||(t?"object":"null")}checkClickOutside(t,e){return!t.contains(e.target)}scrollToTop(){var t=this;const e=document.documentElement.scrollTop||document.body.scrollTop;e>0&&(window.requestAnimationFrame((function(){return t.scrollToTop()})),window.scrollTo(0,e-e/8))}smoothScroll(t){var e;null===(e=document.querySelector(t))||void 0===e||e.scrollIntoView({behavior:"smooth"})}continueRequestOnUnload1(t="",e={}){fetch(t,{method:"POST",body:JSON.stringify(e),keepalive:!0})}continueRequestOnUnload2(t="",e={}){navigator.sendBeacon(t,JSON.stringify(e))}flipAnimate(t,e=500){const n=t.getBoundingClientRect();window.getComputedStyle(t).opacity;t.style.transform=`translate(${n.left}px, ${n.top}px)`,t.style.opacity="0",t.offsetWidth;const o=t.getBoundingClientRect(),r=(window.getComputedStyle(t).opacity,n.left-o.left),i=n.top-o.top;t.style.transform="translate(0, 0)",t.style.opacity="1",t.animate([{transform:`translate(${r}px, ${i}px)`,opacity:"0"},{transform:"translate(0, 0)",opacity:"1"}],{duration:e,easing:"ease-in-out"})}cloneData(t){return t?JSON.parse(JSON.stringify(t)):t}qsLib(t){const e=t.length;return!e||e>2?null:1===e?document.querySelector(t[0]):2===e?t[0].querySelector(t[1]):null}}class Service extends Memory{constructor(){super(),this.get=this.get.bind(this),this.post=this.post.bind(this),this.postFormData=this.postFormData.bind(this),this.put=this.put.bind(this)}getHeaders(){const t={"Content-Type":"application/json","X-TASK-VERSION":window.XTASKVERSION||"2.0.0","Request-Language":langLib},e=this.getCookie("access_token");return e&&(t.Authorization="Bearer "+e),t}get(t,e={}){return fetch(t,{method:"GET",headers:_objectSpread(_objectSpread({},this.getHeaders()),e)}).then((function(t){return t.json()}))}post(t,e,n={}){return fetch(t,{method:"POST",headers:_objectSpread(_objectSpread({},this.getHeaders()),n),body:JSON.stringify(e)}).then((function(t){return t.json()}))}postFormData(t,e,n={}){const o=_objectSpread(_objectSpread({},this.getHeaders()),n);delete o["Content-Type"];const r=new FormData;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.append(t,e[t]);return fetch(t,{method:"POST",headers:o,body:r}).then((function(t){return t.json()}))}put(t,e,n={}){return fetch(t,{method:"PUT",headers:n,body:JSON.stringify(e)}).then((function(t){return t.status}))}}class API extends Service{constructor(){super(),_defineProperty(this,"ApiUrls",{"add-task":"ai/ai-tool/add-task","get-task":"ai/tool/get-task","get-access-url":"ai/source/get-access-url","temp-upload-url":"ai/source/temp-upload-url","can-task":"ai/tool/can-task","get-upload-url":"ai/source/get-upload-url",dance:"ai/tool/dance"}),this.postTemp=this.postTemp.bind(this),this.addTask=this.addTask.bind(this),this.danceTask=this.danceTask.bind(this),this.getTask=this.getTask.bind(this),this.getAccessUrl=this.getAccessUrl.bind(this),this.tempUploadUrl=this.tempUploadUrl.bind(this),this.canTask=this.canTask.bind(this),this.getUploadUrl=this.getUploadUrl.bind(this),this.loopTask=this.loopTask.bind(this),this.uploadAssets=this.uploadAssets.bind(this),this.downloadAssets=this.downloadAssets.bind(this),"miocreate"===siteName&&console.log("我是 mio, 此处可以修改 this.ApiUrls")}async postTemp(t={},e="",n=""){try{const o=await this.post(n||`${baseApiLib}${this.ApiUrls[e]}`,t);return Promise.resolve(o)}catch(t){return Promise.reject(t)}}async addTask(t={}){return await this.postTemp(t,"add-task")}async danceTask(t={}){return await this.postTemp(t,"dance")}async getTask(t={}){return await this.postTemp(t,"get-task")}async getAccessUrl(t={}){return await this.postTemp(t,"get-access-url")}async tempUploadUrl(t={}){return await this.postTemp(t,"temp-upload-url")}async canTask(t={}){return await this.postTemp(t,"can-task")}async getUploadUrl(t={}){const e=`${baseApiOldLib||baseApiLib}${this.ApiUrls["get-upload-url"]}`;return await this.postTemp(t,"",e)}async loopTask(t={},e="",n=function(){}){const o=this;try{var r,i,s;let a=null;a="dance"===e?await this.danceTask(t):await this.addTask(t);const c=null===(r=a)||void 0===r?void 0:r.code,l=null===(i=a)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.task_id;if(200!==c||!l)return Promise.resolve({code:c});try{const t=await async function(t,e=function(){}){let n=0;for(;;){try{var r;const n=await o.getTask({id:t}),s=null==n||null===(r=n.data)||void 0===r?void 0:r.status;var i;if(0===s)return await(null==e?void 0:e(n)),Promise.resolve((null==n||null===(i=n.data)||void 0===i?void 0:i.additional_data)??{});if(![0,-1,-2].includes(s))return Promise.reject()}catch(t){if(n>=5)return Promise.reject();n++}await new Promise((function(t){return setTimeout(t,5e3)}))}}.call(this,l,n);return Promise.resolve({code:200,task_id:l,data:t})}catch(t){return Promise.reject(t)}}catch(t){return Promise.reject(t)}}async uploadAssets({fileName:t,file:e,permanent:n=!1}){try{var o,r;const i=await(n?this.getUploadUrl:this.tempUploadUrl)({file_name:t||`default.${e.type}`});console.log("res",i);const s=null==i?void 0:i.code,a=null==i||null===(o=i.data)||void 0===o?void 0:o.upload_url,c=null==i||null===(r=i.data)||void 0===r?void 0:r.key;if(200===s&&a){const t=new Blob([e],{type:e.type}),n=await function(t){return new Promise((function(e){const n=new FileReader;n.onload=function(){e(!0)},n.onerror=function(t){e(!1)},n.readAsArrayBuffer(t)}))}(t);if(!n)return Promise.resolve({code:404,message:"no such file"});return 200===await this.put(a,t)?Promise.resolve({code:200,key:c}):Promise.reject()}return Promise.reject()}catch(t){return Promise.reject(t)}}async downloadAssets({key:t,filename:e="",callback:n=function(){}}){try{var o,r;const i=await this.getAccessUrl({key:t}),s=null==i?void 0:i.code,a=null==i||null===(o=i.data)||void 0===o?void 0:o.static_url,c=null==i||null===(r=i.data)||void 0===r?void 0:r.url,l=a||c;if(200===s&&l){let t=!1;this.get(l).then((function(e){var o;if(!e.ok)return t=!0,void(null==n||n({status:e.status,error:!0}));t=!1;const r=e.headers.get("Content-Length"),i=parseInt(r||"0",10);let s=0;const a=null===(o=e.body)||void 0===o?void 0:o.getReader();if(!a)throw new Error("Response body is not readable");return new ReadableStream({start:e=>function o(){return a.read().then((function({done:t,value:r}){if(t)return void e.close();s+=r.length;const a=i>0?Math.round(s/i*100):0;return null==n||n({progress:a,error:!1}),e.enqueue(r),o()})).catch((function(){throw null==n||n({error:!0}),e.error(t),t}))}()})})).then((function(t){return new Response(t)})).then((function(t){return t.blob()})).then((function(o){if(t)null==n||n({error:!0});else{const t=URL.createObjectURL(o),n=document.createElement("a");n.href=t,n.download=e,n.click(),URL.revokeObjectURL(t)}})).catch((function(){null==n||n({error:!0})}))}else null==n||n({error:!0})}catch(t){null==n||n({error:!0})}}}const $$=function(t=Language.en,e="vidnoz"){setVars(t,e);const n=new Memory,o=new Methods,r=new Service,i=new API;return new Proxy({},{get:(t,e)=>e in n?"function"==typeof n[e]?n[e].bind(n):n[e]:e in o?"function"==typeof o[e]?o[e].bind(o):o[e]:e in r?"function"==typeof r[e]?r[e].bind(r):r[e]:e in i?"function"==typeof i[e]?i[e].bind(i):i[e]:void 0})};